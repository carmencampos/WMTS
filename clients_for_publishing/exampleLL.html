<html>
<head>
<title>Leaflet PHP/MBTiles Example</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src='http://api.tiles.mapbox.com/mapbox.js/v0.6.4/mapbox.js'></script>
	<link href='http://api.tiles.mapbox.com/mapbox.js/v0.6.4/mapbox.css' rel='stylesheet' />
	<link rel="stylesheet" href="lib/Leaflet/dist/leaflet.css" />
    	<link rel="stylesheet" href="src/L.Control.Zoomslider.css" />
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4.5/leaflet.css" />
	<script src='wax/ext/leaflet.js' type='text/javascript'></script>
	<script src='wax/dist/wax.leaf.js' type='text/javascript'></script>
	<link href='wax/ext/leaflet.css' rel='stylesheet' type='text/css' />
	<!-- files for style -->
	<link rel="stylesheet" type="text/css" href="style/header.css" media="screen" />
	<link rel="stylesheet" type="text/css" href="style/footer.css" media="screen" />
	<link rel="stylesheet" type="text/css" href="style/tutorial.css" media="screen" />
    <style>
    .olControlAttribution {
    	font-size: smaller; 
    	right: 2px;
    	bottom: 2px;
    	position: absolute; 
    	display: block;
    }
	.olImageLoadError { 
		/* when OL encounters a 404, don't display the pink image */
		display: none !important;
	} 
    </style>
</head>

<body>

<!-- header -->
<div id="header">
<div id="title">
	<h1 id="wmts">Web Map Tile Service</h1>
	<a id="linkhsr" href="http://www.hsr.ch">
		<img src="images/logo_hsr.gif" alt="HSR"></a>
</div>

<div id="menu">
<ul>
  <li><h2><a href="../index.html" title="maptiler example">Home</a></h2></li>
</ul>

<ul>
  <li><h2>TileMill</h2>
    <ul>
       <li><a href="../exampleLL.html" title="tillemill example">Initial example using TileMill</a></li>
       <li><a href="../switzerlandLL.html" title="tilemill advanced">Using TileMill with data about Switzerland</a></li>
    </ul>
  </li>
</ul>

<ul>
  <li><h2>MapTiler</h2>
    <ul>
       <li><a href="../maptiler.html" title="maptiler example">Initial example using MapTiler</a></li>
    </ul>
  </li>
</ul>

<ul> <!--  style="float:right" -->
  <li><h2>Go to...</h2>
    <ul>
       <li><a href="../tilemill.html" title="tillemill example">How to create this?</a></li>
    </ul>
  </li>
</ul>
</div>
</div>

<script src="http://cdn.leafletjs.com/leaflet-0.4.5/leaflet.js"></script>
<script src="lib/Leaflet/dist/leaflet-src.js"></script>
<script src="src/L.Control.Zoomslider.js" ></script>

<!-- space where we are going to place the map -->
<div id="map" style="width: 100%; height: 460px"></div>

<!-- footer -->
<div id="footer">
<p id="data">14.06.2013 by OpenStreetMap</p>
<p id="info">About Feedback Terms of Use Geometa Lab</p>
</div> 

<script>

var map;

// We take data from OpenStreetMap to use a base layer
var oam = new L.TileLayer("http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg", {
	maxZoom: 17,
	subdomains: ["otile1", "otile2", "otile3", "otile4"],
});

// this part is to show the layer using the local map
// we need the mbtiles.php file to extract the tiles
// mbtiles.php?db=example.mbtiles&z={z}&x={x}&y={y} is the local url
// in general would be {name-of-the-file-to-extract-the-map}.php?db={name-of-the-map}.mbtiles&z={z}&x={x}&y={y}
var mbTiles = new L.tileLayer('mbtiles.php?db=example.mbtiles&z={z}&x={x}&y={y}', {
	// inverses Y axis numbering for tiles (turn this on for TMS services)
	tms: true,
	opacity: 0.8,
});

// this part is to show the layer using the map hosted in mapbox
// http://{s}.tiles.mapbox.com/v3/carmencampos.example/{z}/{x}/{y}.png is the url where our map is hosted in mapbox
// in general would be http://{s}.tiles.mapbox.com/v3/{user}.{name-of-the-map}/{z}/{x}/{y}.png
var hostedTiles = new L.tileLayer('http://{s}.tiles.mapbox.com/v3/carmencampos.example/{z}/{x}/{y}.png', {
	//If true, inverses Y axis numbering for tiles (turn this on for TMS services)
	tms: false,
	// {s} means one of the randomly chosen subdomains, and here we specificate which are the subdomains
	// This lets you spread out the requests across multiple subdomains which helps both for sharing your 
	// requests to the server, and to download more tiles in parallel
	subdomains: ["a", "b", "c", "d"],
	opacity: 0.7,
});

// we can decide which one of these layers we want to show, or none of them
var overlays = {
	"Local MBTiles File": mbTiles,
	"Hosted Tiles": hostedTiles
};

// the baseLayers appears always on the map
var baseLayers = {
	"MapQuest Streets": oam,
};

layersControl = new L.Control.Layers(baseLayers, overlays, {
	// using "true" the switched layer box appears collapsed
	collapsed: true
});
	
var url = 'http://a.tiles.mapbox.com/v3/carmencampos.example.jsonp';

// We need Wax to add the legend and the tooltips to the map
wax.tilejson(url,
  function(tilejson) {
  // here we create the map
	map = new L.Map("map",{
		// these are the layers that appear by default
		layers: [oam, hostedTiles]
	}).fitWorld();
		
	// To add a legend
	wax.leaf.legend(map, tilejson).appendTo(map._container);
	
	// To add interaction
	wax.leaf.interaction()
    .map(map)
    .tilejson(tilejson)
	// In this case, we add tooltip
    .on(wax.tooltip().animate(true).parent(map._container).events());
	
	// Add to switch between the available layers
	map.addControl(layersControl);
});

</script>
</body>
</html>